let socket,heartbeat,connectionFailures=0,reconnectTimer=null,progressInterval=null,spotifyData=null,currentAudio=null,currentPlayingButton=null,refreshCooldown=!1,isOffline=!1,timestampsInterval=null;const DISCORD_ID="1284213607390908487",STATSFM_ID="31jq7jq2zz2oyatzonpumosodmxi",PLACEHOLDER_IMG="data:image/svg+xml,%3csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M21 19V5C21 3.89543 20.1046 3 19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19Z' stroke='%238b949e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3e%3cpath d='M8.5 10C9.32843 10 10 9.32843 10 8.5C10 7.67157 9.32843 7 8.5 7C7.67157 7 7 7.67157 7 8.5C7 9.32843 7.67157 10 8.5 10Z' fill='%238b949e'/%3e%3cpath d='M21 15L16 10L5 21' stroke='%238b949e' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e";function connect(){(!socket||socket.readyState!==WebSocket.OPEN&&socket.readyState!==WebSocket.CONNECTING)&&(isOffline||resetLoaders(),(socket=new WebSocket("wss://api.lanyard.rest/socket")).addEventListener("open",()=>{isOffline=!1,resetLoaders(),connectionFailures=0,reconnectTimer&&(clearTimeout(reconnectTimer),reconnectTimer=null)}),socket.addEventListener("message",e=>{let t;try{t=JSON.parse(e.data)}catch(n){return}switch(t.op){case 1:let a=t.d?.heartbeat_interval||3e4;socket.readyState===WebSocket.OPEN?socket.send(JSON.stringify({op:2,d:{subscribe_to_ids:[DISCORD_ID]}})):socket.addEventListener("open",()=>{try{socket.send(JSON.stringify({op:2,d:{subscribe_to_ids:[DISCORD_ID]}}))}catch(e){}},{once:!0}),heartbeat&&(clearInterval(heartbeat),heartbeat=null),heartbeat=setInterval(()=>{if(socket.readyState===WebSocket.OPEN)try{socket.send(JSON.stringify({op:3}))}catch(e){}},Math.max(a,1e3));break;case 0:if("INIT_STATE"===t.t||"PRESENCE_UPDATE"===t.t){isOffline=!1;let i="INIT_STATE"===t.t?t.d[DISCORD_ID]:t.d;document.getElementById("profile-loader")?.classList.add("hidden"),document.getElementById("spotify-loader")?.classList.add("hidden"),updateStatus(i)}}}),socket.addEventListener("error",()=>{try{socket.close()}catch(e){}}),socket.addEventListener("close",()=>{heartbeat&&(clearInterval(heartbeat),heartbeat=null),connectionFailures++;let e=3e4,t=Math.min(e,1e3*Math.pow(2,connectionFailures-1));setTimeout(()=>{connect()},t+=1e3*Math.random()),reconnectTimer&&clearTimeout(reconnectTimer),reconnectTimer=setTimeout(updateStatusDisconnected,2e3)}))}function formatTime(e){return isNaN(e)?"0:00":`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}function updateProgress(){if(!spotifyData)return;let e=Date.now(),t=e-spotifyData.timestamps.start,n=spotifyData.timestamps.end-spotifyData.timestamps.start,a=n-t;document.getElementById("progress-fill").style.width=Math.min(t/n*100,100)+"%",document.getElementById("time-elapsed").textContent=formatTime(t/1e3),document.getElementById("time-remaining").textContent=`-${formatTime(a>0?a/1e3:0)}`}function triggerUpdateAnimation(e){e.classList.remove("updated"),e.offsetWidth,e.classList.add("updated"),e.addEventListener("animationend",()=>e.classList.remove("updated"),{once:!0})}function updateStatus(e){if(!e){updateStatusDisconnected();return}let t=document.getElementById("profile-banner");if(e.kv&&e.kv.banner&&e.discord_user){let n=e.kv.banner,a=e.discord_user.id,i=n.startsWith("a_")?"gif":"png",s=`https://cdn.discordapp.com/banners/${a}/${n}.${i}?size=480`;t.src!==s&&(t.src=s),t.style.display="block"}else t.style.display="none";let r=document.getElementById("avatar"),o=document.getElementById("avatar-decoration"),l=document.getElementById("display-name"),d=document.getElementById("at-username"),c=document.getElementById("custom-status"),u=document.getElementById("status-icon"),y=document.getElementById("devices"),p=document.getElementById("spotify-card"),m=document.getElementById("spotify-active"),$=document.getElementById("spotify-inactive");if(e.discord_user){let _=e.discord_user,g=_.global_name||_.username;l.textContent!==g&&(l.textContent=g,triggerUpdateAnimation(l));let v=`@${_.username}`;d.textContent!==v&&(d.textContent=v,triggerUpdateAnimation(d));let f=_.avatar?`https://cdn.discordapp.com/avatars/${_.id}/${_.avatar}.${_.avatar.startsWith("a_")?"gif":"png"}?size=128`:PLACEHOLDER_IMG;r.src!==f&&(r.src=f,triggerUpdateAnimation(r));let h=_.avatar_decoration_data?`https://cdn.discordapp.com/avatar-decoration-presets/${_.avatar_decoration_data.asset}.png?size=96`:"";o.src!==h&&(o.src=h,o.style.display=h?"block":"none")}let k={online:{class:"online"},idle:{class:"idle"},dnd:{class:"dnd"},offline:{class:"offline"}},I=k[e.discord_status]||k.offline;u.className=`status ${I.class}`,triggerUpdateAnimation(u);let E=(e.active_on_discord_web?"w":"")+(e.active_on_discord_desktop?"d":"")+(e.active_on_discord_mobile?"m":"");if(y.dataset.active!==E&&(y.dataset.active=E,y.innerHTML="",e.active_on_discord_web&&(y.innerHTML+='<svg class="device-icon" aria-label="Web" height="20" width="20" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93Zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39Z"></path></svg>'),e.active_on_discord_desktop&&(y.innerHTML+='<svg class="device-icon" aria-label="Desktop" height="20" width="20" viewBox="0 0 24 24"><path d="M4 2.5c-1.103 0-2 .897-2 2v11c0 1.104.897 2 2 2h7v2H7v2h10v-2h-4v-2h7c1.103 0 2-.896 2-2v-11c0-1.103-.897-2-2-2H4Zm16 2v9H4v-9h16Z"></path></svg>'),e.active_on_discord_mobile&&(y.innerHTML+='<svg class="device-icon" aria-label="Mobile" height="20" width="20" viewBox="0 0 1000 1500"><path d="M 187 0 L 813 0 C 916.277 0 1000 83.723 1000 187 L 1000 1313 C 1000 1416.277 916.277 1500 813 1500 L 187 1500 C 83.723 1500 0 1416.277 0 1313 L 0 187 C 0 83.723 83.723 0 187 0 Z M 125 1000 L 875 1000 L 875 250 L 125 250 Z M 500 1125 C 430.964 1125 375 1180.964 375 1250 C 375 1319.036 430.964 1375 500 1375 C 569.036 1375 625 1319.036 625 1250 C 625 1180.964 569.036 1125 500 1125 Z"></path></svg>')),e.listening_to_spotify&&e.spotify){let b=e.spotify.track_id;if(p.dataset.trackId!==b){p.dataset.trackId=b,m.style.display="block",$.style.display="none",document.getElementById("album-art").src=e.spotify.album_art_url,document.getElementById("song-name").textContent=e.spotify.song,document.getElementById("artist-name").textContent=e.spotify.artist.replace(/; /g,", "),document.getElementById("album-name").textContent=e.spotify.album;let L=m.querySelector(".spotify-container");L&&triggerUpdateAnimation(L)}spotifyData=e.spotify,progressInterval&&clearInterval(progressInterval),progressInterval=setInterval(updateProgress,100),updateProgress()}else if("none"!==p.dataset.trackId){p.dataset.trackId="none",spotifyData=null,m.style.display="none",$.style.display="block",progressInterval&&(clearInterval(progressInterval),progressInterval=null);let B=$.querySelector(".spotify-container");B&&triggerUpdateAnimation(B)}let w=e.activities.find(e=>4===e.type),S=w&&w.state?w.state:"";c.textContent!==S&&(c.textContent=S,c.style.display=S?"block":"none",S&&triggerUpdateAnimation(c))}function resetLoaders(){["profile-loader","spotify-loader"].forEach(e=>{let t=document.getElementById(e);t&&(t.classList.remove("hidden","error"),t.querySelector("span").textContent="Loading..")})}function updateStatusDisconnected(){isOffline=!0,document.getElementById("profile-banner").style.display="none",["profile-loader","spotify-loader"].forEach(e=>{let t=document.getElementById(e);t&&(t.classList.remove("hidden"),t.classList.add("error"),t.querySelector("span").textContent="You are offline")})}function formatTimeAgo(e){let t=new Date,n=new Date(e),a=Math.floor((t-n)/6e4),i=Math.floor(a/60);return a<1?"Just now":a<60?`${a}m ago`:i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function updatePlayIcons(e){let t=document.getElementById("media-play-pause-btn"),n=t.querySelector(".play-icon"),a=t.querySelector(".pause-icon");e?(n.style.display="none",a.style.display="block",currentPlayingButton&&(currentPlayingButton.classList.add("playing"),currentPlayingButton.querySelector(".play-icon").style.display="none",currentPlayingButton.querySelector(".pause-icon").style.display="block")):(n.style.display="block",a.style.display="none",currentPlayingButton&&(currentPlayingButton.classList.remove("playing"),currentPlayingButton.querySelector(".play-icon").style.display="block",currentPlayingButton.querySelector(".pause-icon").style.display="none"))}function closeMediaPlayer(){document.getElementById("media-player").classList.remove("visible"),currentAudio&&(currentAudio.pause(),currentAudio.src="",currentAudio=null),updatePlayIcons(!1),currentPlayingButton=null,"mediaSession"in navigator&&(navigator.mediaSession.metadata=null,navigator.mediaSession.setActionHandler("play",null),navigator.mediaSession.setActionHandler("pause",null),navigator.mediaSession.playbackState="none")}function stopCurrentAudio(){currentAudio&&(currentAudio.pause(),updatePlayIcons(!1)),currentPlayingButton&&(currentPlayingButton.classList.remove("playing"),currentPlayingButton.querySelector(".play-icon").style.display="block",currentPlayingButton.querySelector(".pause-icon").style.display="none")}function toggleMediaPlayerState(){currentAudio&&(currentAudio.paused?(currentAudio.play(),updatePlayIcons(!0)):(currentAudio.pause(),updatePlayIcons(!1)))}function togglePlay(e,t){let n=t.spotifyPreview||t.appleMusicPreview;if(!n)return;if(e===currentPlayingButton){toggleMediaPlayerState();return}closeMediaPlayer();let a=document.getElementById("media-player"),i=document.getElementById("media-album-art"),s=t.albums[0]?.image||PLACEHOLDER_IMG;if(i.src!==s&&(i.src=s),document.getElementById("media-song-title").textContent=t.name,document.getElementById("media-song-artist").textContent=t.artists.map(e=>e.name).join(", "),"mediaSession"in navigator){let r=navigator.mediaSession.metadata?.title;r!==t.name&&(navigator.mediaSession.metadata=new MediaMetadata({title:t.name,artist:t.artists.map(e=>e.name).join(", "),album:t.albums[0]?.name||""})),navigator.mediaSession.setActionHandler("play",()=>toggleMediaPlayerState()),navigator.mediaSession.setActionHandler("pause",()=>toggleMediaPlayerState())}(currentAudio=new Audio(n)).volume=.8,currentPlayingButton=e;let o=document.getElementById("seek-slider"),l=document.getElementById("media-current-time"),d=document.getElementById("media-total-time");currentAudio.addEventListener("loadedmetadata",()=>{o.max=currentAudio.duration,d.textContent=formatTime(currentAudio.duration)}),currentAudio.addEventListener("timeupdate",()=>{currentAudio&&(o.value=currentAudio.currentTime,l.textContent=formatTime(currentAudio.currentTime))}),currentAudio.addEventListener("play",()=>updatePlayIcons(!0)),currentAudio.addEventListener("pause",()=>updatePlayIcons(!1)),o.oninput=()=>{currentAudio&&(currentAudio.currentTime=o.value)},currentAudio.play().catch(()=>{}),a.classList.add("visible"),currentAudio.addEventListener("ended",closeMediaPlayer,{once:!0})}function addPlayButtonListeners(e){document.querySelectorAll(".play-button").forEach(t=>{let n=t.dataset.previewUrl;if(!n)return;let a=e.find(e=>e.track.spotifyPreview===n||e.track.appleMusicPreview===n);a&&t.addEventListener("click",()=>togglePlay(t,a.track))})}function updateTimestamps(){document.querySelectorAll("#recent-songs-container .song-meta span[data-timestamp]").forEach(e=>{e.textContent=formatTimeAgo(e.dataset.timestamp)})}async function loadRecentSongs(){let e=document.getElementById("recent-songs-container"),t=document.getElementById("songs-loader"),n=currentAudio&&!currentAudio.paused,a=currentAudio?currentAudio.src:null;timestampsInterval&&(clearInterval(timestampsInterval),timestampsInterval=null),t.querySelector("span").textContent="Loading..",t.classList.remove("hidden","error");try{let i=await fetch(`https://api.stats.fm/api/v1/users/31jq7jq2zz2oyatzonpumosodmxi/streams/recent?_=${Date.now()}`);if(!i.ok)throw Error("Failed to fetch");let s=await i.json();e.style.opacity=0,setTimeout(()=>{if(s.items&&s.items.length>0){let t=s.items.slice(0,20),i=t.map(e=>{let t=e.track,n=t.albums[0]?.image||PLACEHOLDER_IMG,a=t.name,i=t.artists.map(e=>e.name).join(", "),s=formatTimeAgo(e.endTime),r=t.spotifyPreview||t.appleMusicPreview;return` <div class="song-item"> <div class="song-album-art-wrapper"> <img src="${n}" class="song-album-art" loading="lazy" draggable="false"> ${r?`<button class="play-button" data-preview-url="${r}"> <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"/></svg> <svg class="pause-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="display:none;"><rect x="14" y="3" width="5" height="18" rx="1"/><rect x="5" y="3" width="5" height="18" rx="1"/></svg> </button>`:""} </div> <div class="song-details"> <div class="song-title">${a}</div> <div class="song-artist-container"> ${t.explicit?'<span class="explicit-tag">E</span>':""} <span class="song-artist-name">${i}</span> </div> </div> <div class="song-meta"> <span data-timestamp="${e.endTime}">${s}</span> </div> </div> `}).join("");if(e.innerHTML=i,addPlayButtonListeners(t),timestampsInterval=setInterval(updateTimestamps,3e4),n){let r=document.querySelector(`.play-button[data-preview-url="${a}"]`);r?(currentPlayingButton=r,updatePlayIcons(!0)):closeMediaPlayer()}}else e.innerHTML='<div class="empty-state">No recent songs</div>',timestampsInterval&&clearInterval(timestampsInterval);e.style.opacity=1},300)}catch(r){e.style.opacity=0,timestampsInterval&&clearInterval(timestampsInterval),setTimeout(()=>{e.innerHTML='<div class="empty-state" style="color: #f87171;">Failed to load</div>',e.style.opacity=1},300)}finally{setTimeout(()=>t.classList.add("hidden"),300)}}document.title=`${window.location.hostname}`,connect(),loadRecentSongs(),document.getElementById("refresh-songs-btn").addEventListener("click",()=>{if(refreshCooldown)return;let e=document.getElementById("refresh-songs-btn");e.disabled=!0,loadRecentSongs(),refreshCooldown=!0,setTimeout(()=>{e.disabled=!1,refreshCooldown=!1},3e4)}),document.getElementById("close-button").addEventListener("click",closeMediaPlayer),document.getElementById("media-play-pause-btn").addEventListener("click",toggleMediaPlayerState),document.addEventListener("keydown",e=>{"Tab"===e.key&&e.preventDefault()}),document.addEventListener("keydown",function(e){("F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key||e.ctrlKey&&e.shiftKey&&"C"===e.key||e.ctrlKey&&"u"===e.key||e.ctrlKey&&"s"===e.key||e.ctrlKey&&"p"===e.key||e.ctrlKey&&"g"===e.key||e.ctrlKey&&"f"===e.key||e.ctrlKey&&"o"===e.key||e.ctrlKey&&"j"===e.key||e.ctrlKey&&"h"===e.key||e.ctrlKey&&"d"===e.key||(e.ctrlKey&&"+"===e.key||"-"===e.key)&&e.ctrlKey)&&e.preventDefault()}),function(){let e=function(){this.keyScrollHandler=function(e){if(e.ctrlKey)return e.preventDefault(),!1}};if(window===top){let t=new e;window.addEventListener("wheel",t.keyScrollHandler,{passive:!1})}}(),document.addEventListener("contextmenu",function(e){e.preventDefault()});
